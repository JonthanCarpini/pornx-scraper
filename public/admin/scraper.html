<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXXFollow - Admin Scraper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }

        .controls {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .controls h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }

        .logs.active {
            display: block;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #00ff00;
            padding-left: 10px;
        }

        .log-entry.error {
            color: #ff4444;
            border-left-color: #ff4444;
        }

        .log-entry.success {
            color: #00ff00;
            border-left-color: #00ff00;
        }

        .log-entry.info {
            color: #4facfe;
            border-left-color: #4facfe;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ XXXFollow Scraper</h1>
            <p>Painel de AdministraÃ§Ã£o e Controle de Scraping</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total de Modelos</h3>
                <div class="number" id="stat-models">0</div>
            </div>
            <div class="stat-card">
                <h3>Total de VÃ­deos</h3>
                <div class="number" id="stat-videos">0</div>
            </div>
            <div class="stat-card">
                <h3>Modelos Pendentes</h3>
                <div class="number" id="stat-pending">0</div>
            </div>
            <div class="stat-card">
                <h3>VÃ­deos Hoje</h3>
                <div class="number" id="stat-today">0</div>
            </div>
        </div>

        <div class="controls">
            <h2>ğŸ® Controles de Scraping</h2>
            
            <div style="margin-bottom: 20px;">
                <label for="scrape-page" style="display: block; margin-bottom: 10px; font-weight: bold; color: #667eea;">
                    ğŸ“„ PÃ¡gina de Scraping de Modelos:
                </label>
                <select id="scrape-page" style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em; background: white; cursor: pointer;">
                    <option value="contest-winners">ğŸ† Contest Winners</option>
                    <option value="newest-creators">âœ¨ Newest Creators</option>
                    <option value="tag/teen-18/all">ï¿½ Teen 18+</option>
                    <option value="tag/fastfap/all">âš¡ FastFap</option>
                    <option value="tag/tiktok18/all">ğŸ“± TikTok 18+</option>
                    <option value="tag/gonewild/all">ğŸ”¥ GoneWild</option>
                    <option value="tag/pussy/all">ï¿½ Pussy</option>
                    <option value="tag/nsfw/all">ğŸ” NSFW</option>
                    <option value="tag/latina/all">ğŸ’ƒ Latina</option>
                    <option value="tag/realgirls/all">ğŸ‘© Real Girls</option>
                    <option value="tag/masturbation/all">ï¿½ Masturbation</option>
                    <option value="tag/cumsluts/all">ğŸ’§ Cumsluts</option>
                    <option value="tag/18/all">ğŸ‚ 18+</option>
                    <option value="tag/porn/all">ğŸ¬ Porn</option>
                    <option value="tag/asiansgonewild/all">ï¿½ Asians Gone Wild</option>
                    <option value="tag/wetpussy/all">ï¿½ Wet Pussy</option>
                    <option value="tag/onlyfans/all">ï¿½ OnlyFans</option>
                    <option value="tag/bustypetite/all">ğŸ’ Busty Petite</option>
                    <option value="tag/schoolgirl/all">ğŸ“ Schoolgirl</option>
                    <option value="tag/tiktokxxx/all">ğŸ“± TikTok XXX</option>
                    <option value="tag/couplesex/all">ğŸ‘« Couple Sex</option>
                    <option value="tag/publicsex/all">ğŸŒ Public Sex</option>
                    <option value="tag/analsex/all">ğŸ‘ Anal Sex</option>
                    <option value="tag/bisexual/all">ğŸŒˆ Bisexual</option>
                    <option value="tag/hardcoresex/all">ğŸ’¥ Hardcore Sex</option>
                    <option value="tag/sexoenpublico/all">ğŸŒ Sexo en Publico</option>
                    <option value="tag/lesbiansex/all">ğŸ‘­ Lesbian Sex</option>
                    <option value="tag/sexopublico/all">ğŸŒ Sexo Publico</option>
                    <option value="tag/sexo/all">ğŸ”¥ Sexo</option>
                    <option value="tag/sexoanal/all">ğŸ‘ Sexo Anal</option>
                    <option value="tag/brazilian/all">ğŸ‡§ğŸ‡· Brazilian</option>
                    <option value="tag/bra/all">ğŸ‡§ğŸ‡· BRA</option>
                    <option value="tag/brasileira/all">ğŸ‡§ğŸ‡· Brasileira</option>
                    <option value="tag/argentina/all">ğŸ‡¦ğŸ‡· Argentina</option>
                    <option value="tag/mexicana/all">ğŸ‡²ğŸ‡½ Mexicana</option>
                    <option value="tag/jovencita18/all">ğŸ‘§ Jovencita 18+</option>
                    <option value="tag/virgin/all">ğŸ’« Virgin</option>
                    <option value="tag/ffm/all">ğŸ‘­ğŸ‘¨ FFM</option>
                    <option value="tag/ebony/all">ğŸ–¤ Ebony</option>
                    <option value="tag/gwcouples/all">ğŸ‘« GW Couples</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label for="custom-url" style="display: block; margin-bottom: 10px; font-weight: bold; color: #f093fb;">
                    ğŸ”— URL Customizada da API (opcional):
                </label>
                <input 
                    type="text" 
                    id="custom-url" 
                    placeholder="https://www.xxxfollow.com/api/v1/post/tag/18years?genders=cf&period=featured&limit=24&page=1&start_time=..."
                    style="width: 100%; padding: 12px; border: 2px solid #f093fb; border-radius: 8px; font-size: 0.9em; background: white;"
                />
                <small style="color: #888; display: block; margin-top: 5px;">
                    ğŸ’¡ Cole uma URL da API do XXXFollow para fazer scraping de tags especÃ­ficas
                </small>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="scrapeModels()" id="btn-models">
                    <span>ğŸ‘¥</span>
                    <span>Scrape Modelos</span>
                </button>
                <button class="btn btn-success" onclick="scrapeVideos()" id="btn-videos">
                    <span>ğŸ¬</span>
                    <span>Scrape VÃ­deos</span>
                </button>
                <button class="btn btn-success" onclick="scrapeVideoDetails()" id="btn-details">
                    <span>ğŸ¥</span>
                    <span>Scrape Detalhes</span>
                </button>
                <button class="btn btn-primary" onclick="scrapeTags()" id="btn-tags" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <span>ğŸ·ï¸</span>
                    <span>Scrape Tags API</span>
                </button>
                <button class="btn btn-danger" onclick="stopScraping()" id="btn-stop" style="display:none; background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                    <span>â›”</span>
                    <span>Parar Scraping</span>
                </button>
                <button class="btn btn-info" onclick="loadStats()">
                    <span>ğŸ“Š</span>
                    <span>Atualizar Stats</span>
                </button>
                <button class="btn btn-warning" onclick="clearLogs()">
                    <span>ğŸ—‘ï¸</span>
                    <span>Limpar Logs</span>
                </button>
            </div>

            <div class="nav-links">
                <a href="/xxxfollow-models.html" class="nav-link">ğŸ“‹ Ver Modelos</a>
                <a href="/xxxfollow-videos.html" class="nav-link">ğŸ¥ Ver VÃ­deos</a>
                <a href="/admin-scraper.html" class="nav-link">ğŸ  Outros Sites</a>
                <a href="/home.html" class="nav-link">ğŸŒ Homepage</a>
            </div>

            <div class="progress-bar" id="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>

            <div class="logs" id="logs"></div>
        </div>
    </div>

    <script>
        // Verificar autenticaÃ§Ã£o ao carregar a pÃ¡gina
        async function checkAuth() {
            try {
                const response = await fetch('/api/admin/verify', {
                    credentials: 'include'
                });

                if (!response.ok) {
                    window.location.href = '/admin/login.html';
                }
            } catch (error) {
                console.error('Erro ao verificar autenticaÃ§Ã£o:', error);
                window.location.href = '/admin/login.html';
            }
        }

        // Executar verificaÃ§Ã£o ao carregar
        checkAuth();

        let isRunning = false;
        let currentEventSource = null;

        function toggleButtons(running) {
            document.getElementById('btn-models').disabled = running;
            document.getElementById('btn-videos').disabled = running;
            document.getElementById('btn-details').disabled = running;
            document.getElementById('btn-stop').style.display = running ? 'flex' : 'none';
        }

        function stopScraping() {
            if (currentEventSource) {
                currentEventSource.close();
                currentEventSource = null;
            }
            isRunning = false;
            toggleButtons(false);
            addLog('â›” Scraping interrompido pelo usuÃ¡rio!', 'error');
            updateProgress(0, 'Parado');
        }

        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            logs.classList.add('active');
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('logs').classList.remove('active');
            document.getElementById('progress-bar').classList.remove('active');
        }

        function updateProgress(percent, text) {
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            
            progressBar.classList.add('active');
            progressFill.style.width = percent + '%';
            progressFill.textContent = text || (percent + '%');
        }

        async function loadStats() {
            try {
                addLog('Carregando estatÃ­sticas...', 'info');
                
                const response = await fetch('/api/xxxfollow/stats');
                const data = await response.json();
                
                document.getElementById('stat-models').textContent = data.totalModels || 0;
                document.getElementById('stat-videos').textContent = data.totalVideos || 0;
                document.getElementById('stat-pending').textContent = data.pendingModels || 0;
                document.getElementById('stat-today').textContent = data.videosToday || 0;
                
                addLog('EstatÃ­sticas atualizadas com sucesso!', 'success');
            } catch (error) {
                addLog('Erro ao carregar estatÃ­sticas: ' + error.message, 'error');
            }
        }

        async function scrapeModels() {
            if (isRunning) {
                addLog('JÃ¡ existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            
            const scrapePage = document.getElementById('scrape-page').value;
            const pageLabel = document.getElementById('scrape-page').selectedOptions[0].text;
            
            addLog(`ğŸš€ Iniciando scraping de modelos: ${pageLabel}`, 'info');
            addLog(`ğŸ“„ URL: https://www.xxxfollow.com/${scrapePage}`, 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource(`/api/xxxfollow/scrape-models-stream?page=${encodeURIComponent(scrapePage)}`);
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        // Detectar tipo de log e adicionar com cor apropriada
                        if (message.includes('âœ“') || message.includes('âœ…')) {
                            addLog(message, 'success');
                        } else if (message.includes('âŒ') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        // Atualizar progresso baseado em palavras-chave
                        if (message.includes('Acessando')) {
                            progress = Math.min(progress + 10, 50);
                            updateProgress(progress, 'Coletando dados...');
                        } else if (message.includes('salva')) {
                            progress = Math.min(progress + 5, 90);
                            updateProgress(progress, 'Salvando modelos...');
                        }
                    } else if (data.type === 'error') {
                        addLog('âŒ ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'ConcluÃ­do!');
                        addLog('âœ… Scraping de modelos concluÃ­do!', 'success');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                currentEventSource.onerror = (error) => {
                    addLog('âŒ Erro na conexÃ£o: ' + error, 'error');
                    currentEventSource.close();
                    currentEventSource = null;
                    isRunning = false;
                    toggleButtons(false);
                };
                
            } catch (error) {
                addLog('âŒ Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        async function scrapeVideos() {
            if (isRunning) {
                addLog('JÃ¡ existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            addLog('ğŸš€ Iniciando scraping de vÃ­deos do XXXFollow...', 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource('/api/xxxfollow/scrape-videos-stream');
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        // Detectar tipo de log e adicionar com cor apropriada
                        if (message.includes('âœ“') || message.includes('âœ…')) {
                            addLog(message, 'success');
                        } else if (message.includes('âŒ') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        // Atualizar progresso baseado em palavras-chave
                        if (message.includes('Scraping vÃ­deos')) {
                            progress = Math.min(progress + 10, 50);
                            updateProgress(progress, 'Processando modelo...');
                        } else if (message.includes('VÃ­deo salvo')) {
                            progress = Math.min(progress + 2, 90);
                            updateProgress(progress, 'Salvando vÃ­deos...');
                        } else if (message.includes('concluÃ­do')) {
                            progress = Math.min(progress + 5, 95);
                        }
                    } else if (data.type === 'error') {
                        addLog('âŒ ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'ConcluÃ­do!');
                        addLog('âœ… Scraping de vÃ­deos concluÃ­do!', 'success');
                        eventSource.close();
                        isRunning = false;
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                eventSource.onerror = (error) => {
                    addLog('âŒ Erro na conexÃ£o: ' + error, 'error');
                    eventSource.close();
                    isRunning = false;
                };
                
            } catch (error) {
                addLog('âŒ Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        async function scrapeTags() {
            if (isRunning) {
                addLog('JÃ¡ existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            
            // Verificar se hÃ¡ URL customizada
            const customUrl = document.getElementById('custom-url').value.trim();
            
            if (customUrl) {
                addLog('ğŸš€ Iniciando scraping de URL customizada...', 'info');
                addLog(`ğŸ”— URL: ${customUrl}`, 'info');
                updateProgress(10, 'Conectando...');
                
                try {
                    const encodedUrl = encodeURIComponent(customUrl);
                    currentEventSource = new EventSource(`/api/xxxfollow/scrape-custom-url-stream?url=${encodedUrl}`);
                    let progress = 10;
                    
                    currentEventSource.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'log') {
                            const message = data.message;
                            
                            if (message.includes('âœ“') || message.includes('âœ…')) {
                                addLog(message, 'success');
                            } else if (message.includes('âŒ') || message.includes('Erro')) {
                                addLog(message, 'error');
                            } else {
                                addLog(message, 'info');
                            }
                            
                            if (message.includes('VÃ­deo salvo')) {
                                progress = Math.min(progress + 2, 90);
                                updateProgress(progress, 'Processando...');
                            }
                        } else if (data.type === 'error') {
                            addLog('âŒ ' + data.message, 'error');
                        } else if (data.type === 'done') {
                            updateProgress(100, 'ConcluÃ­do!');
                            addLog('âœ… Scraping de URL customizada concluÃ­do!', 'success');
                            currentEventSource.close();
                            currentEventSource = null;
                            isRunning = false;
                            toggleButtons(false);
                            setTimeout(() => loadStats(), 1000);
                        }
                    };
                    
                    currentEventSource.onerror = (error) => {
                        addLog('âŒ Erro na conexÃ£o: ' + error, 'error');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                    };
                    
                } catch (error) {
                    addLog('âŒ Erro: ' + error.message, 'error');
                    isRunning = false;
                    toggleButtons(false);
                }
                return;
            }
            
            // Scraping normal de todas as tags
            addLog('ğŸš€ Iniciando scraping de tags via API...', 'info');
            addLog('ğŸ·ï¸  Processando 53 tags com modelos e vÃ­deos...', 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource('/api/xxxfollow/scrape-tags-stream');
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        if (message.includes('âœ“') || message.includes('âœ…')) {
                            addLog(message, 'success');
                        } else if (message.includes('âŒ') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        if (message.includes('Tag')) {
                            progress = Math.min(progress + 2, 90);
                            updateProgress(progress, 'Processando tags...');
                        }
                    } else if (data.type === 'error') {
                        addLog('âŒ ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'ConcluÃ­do!');
                        addLog('âœ… Scraping de tags concluÃ­do!', 'success');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                currentEventSource.onerror = (error) => {
                    addLog('âŒ Erro na conexÃ£o: ' + error, 'error');
                    currentEventSource.close();
                    currentEventSource = null;
                    isRunning = false;
                    toggleButtons(false);
                };
                
            } catch (error) {
                addLog('âŒ Erro: ' + error.message, 'error');
                isRunning = false;
                toggleButtons(false);
            }
        }

        async function scrapeVideoDetails() {
            if (isRunning) {
                addLog('JÃ¡ existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            addLog('ğŸš€ Iniciando scraping de detalhes dos vÃ­deos...', 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource('/api/xxxfollow/scrape-video-details-stream');
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        if (message.includes('âœ“') || message.includes('âœ…')) {
                            addLog(message, 'success');
                        } else if (message.includes('âŒ') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        if (message.includes('Source atualizado')) {
                            progress = Math.min(progress + 2, 90);
                            updateProgress(progress, 'Extraindo sources...');
                        }
                    } else if (data.type === 'error') {
                        addLog('âŒ ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'ConcluÃ­do!');
                        addLog('âœ… Scraping de detalhes concluÃ­do!', 'success');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                currentEventSource.onerror = (error) => {
                    addLog('âŒ Erro na conexÃ£o: ' + error, 'error');
                    currentEventSource.close();
                    currentEventSource = null;
                    isRunning = false;
                    toggleButtons(false);
                };
                
            } catch (error) {
                addLog('âŒ Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        // Carregar estatÃ­sticas ao abrir a pÃ¡gina
        window.addEventListener('load', () => {
            loadStats();
        });
    </script>
</body>
</html>
