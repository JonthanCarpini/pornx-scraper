<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard - Painel Administrativo OnlySuper">
    <title>Dashboard - OnlySuper Admin</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Principal -->
    <link rel="stylesheet" href="/admin/assets/css/main.css">
    
    <style>
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }

        .quick-action-card {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all var(--transition-base);
            text-align: center;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-300);
        }

        .quick-action-icon {
            font-size: 48px;
            margin-bottom: var(--space-3);
        }

        .quick-action-title {
            font-size: var(--text-base);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }

        .quick-action-desc {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .chart-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-md);
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            transition: background-color var(--transition-fast);
        }

        .activity-item:hover {
            background: var(--bg-secondary);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
            flex-shrink: 0;
        }

        .activity-icon.success {
            background: var(--success-50);
        }

        .activity-icon.warning {
            background: var(--warning-50);
        }

        .activity-icon.info {
            background: var(--info-50);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .activity-time {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar ser√° injetada via JavaScript -->
        
        <!-- Conte√∫do Principal -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <span>‚ò∞</span>
                    </button>
                    <div>
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Vis√£o geral do sistema</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-search">
                        <span class="header-search-icon">üîç</span>
                        <input 
                            type="text" 
                            class="header-search-input" 
                            placeholder="Buscar..."
                            id="globalSearch"
                        >
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" title="Notifica√ß√µes">
                            <span>üîî</span>
                            <span class="header-btn-badge">3</span>
                        </button>
                        <button class="header-btn" title="Configura√ß√µes">
                            <span>‚öôÔ∏è</span>
                        </button>
                        <button class="header-btn" onclick="location.reload()" title="Atualizar">
                            <span>üîÑ</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Container de Conte√∫do -->
            <div class="content-container">
                <!-- Stats Cards - Usu√°rios -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Total de Usu√°rios</div>
                            <div class="stat-card-icon primary">üë•</div>
                        </div>
                        <div class="stat-card-value" id="totalUsers">-</div>
                        <div class="stat-card-change" id="totalUsersChange"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Usu√°rios Ativos</div>
                            <div class="stat-card-icon success">‚úÖ</div>
                        </div>
                        <div class="stat-card-value" id="activeUsers">-</div>
                        <div class="stat-card-change" id="activeUsersChange"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Assinaturas Ativas</div>
                            <div class="stat-card-icon success">üíé</div>
                        </div>
                        <div class="stat-card-value" id="activeSubscriptions">-</div>
                        <div class="stat-card-change" id="activeSubscriptionsChange"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Assinaturas Vencidas</div>
                            <div class="stat-card-icon warning">‚è∞</div>
                        </div>
                        <div class="stat-card-value" id="expiredSubscriptions">-</div>
                        <div class="stat-card-change" id="expiredSubscriptionsChange"></div>
                    </div>
                </div>

                <!-- Stats Cards - Conte√∫do -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Total de Modelos</div>
                            <div class="stat-card-icon primary">üë§</div>
                        </div>
                        <div class="stat-card-value" id="totalModels">-</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Total de V√≠deos</div>
                            <div class="stat-card-icon success">üé¨</div>
                        </div>
                        <div class="stat-card-value" id="totalVideos">-</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Sess√µes Ativas</div>
                            <div class="stat-card-icon success">üîê</div>
                        </div>
                        <div class="stat-card-value" id="activeSessions">-</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Usu√°rios Online</div>
                            <div class="stat-card-icon success">üü¢</div>
                        </div>
                        <div class="stat-card-value" id="onlineUsers">-</div>
                    </div>
                </div>

                <!-- A√ß√µes R√°pidas -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üöÄ A√ß√µes R√°pidas</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions">
                            <div class="quick-action-card" onclick="window.location.href='/admin/scraper.html'">
                                <div class="quick-action-icon">ü§ñ</div>
                                <div class="quick-action-title">Scraper XXXFollow</div>
                                <div class="quick-action-desc">Coletar modelos e v√≠deos</div>
                            </div>

                            <div class="quick-action-card" onclick="window.location.href='/admin/users.html'">
                                <div class="quick-action-icon">üë•</div>
                                <div class="quick-action-title">Gerenciar Usu√°rios</div>
                                <div class="quick-action-desc">Criar e editar usu√°rios</div>
                            </div>

                            <div class="quick-action-card" onclick="window.location.href='/admin/sessions.html'">
                                <div class="quick-action-icon">üîê</div>
                                <div class="quick-action-title">Sess√µes Ativas</div>
                                <div class="quick-action-desc">Monitorar sess√µes</div>
                            </div>

                            <div class="quick-action-card" onclick="window.location.href='/admin/content.html'">
                                <div class="quick-action-icon">üóÇÔ∏è</div>
                                <div class="quick-action-title">Gerenciar Conte√∫do</div>
                                <div class="quick-action-desc">CRUD de modelos e v√≠deos</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grid de 2 Colunas -->
                <div class="content-grid grid-2">
                    <!-- Atividade Recente -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìä Atividade Recente</h3>
                        </div>
                        <div class="card-body">
                            <div id="activityList">
                                <div class="activity-item">
                                    <div class="activity-icon success">‚úÖ</div>
                                    <div class="activity-content">
                                        <div class="activity-title">Novo usu√°rio cadastrado</div>
                                        <div class="activity-time">H√° 5 minutos</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon info">üé¨</div>
                                    <div class="activity-content">
                                        <div class="activity-title">50 novos v√≠deos coletados</div>
                                        <div class="activity-time">H√° 15 minutos</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon warning">‚ö†Ô∏è</div>
                                    <div class="activity-content">
                                        <div class="activity-title">Sess√£o encerrada pelo admin</div>
                                        <div class="activity-time">H√° 30 minutos</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon success">üë•</div>
                                    <div class="activity-content">
                                        <div class="activity-title">10 novas modelos adicionadas</div>
                                        <div class="activity-time">H√° 1 hora</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informa√ß√µes do Sistema -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üíª Informa√ß√µes do Sistema</h3>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                                        <span style="font-size: var(--text-sm); color: var(--text-secondary);">Status</span>
                                        <span class="badge badge-success">üü¢ Online</span>
                                    </div>
                                </div>

                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                                        <span style="font-size: var(--text-sm); color: var(--text-secondary);">√öltima atualiza√ß√£o</span>
                                        <span style="font-size: var(--text-sm); font-weight: var(--font-medium);" id="lastUpdate">-</span>
                                    </div>
                                </div>

                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                                        <span style="font-size: var(--text-sm); color: var(--text-secondary);">Vers√£o</span>
                                        <span style="font-size: var(--text-sm); font-weight: var(--font-medium);">2.0.0</span>
                                    </div>
                                </div>

                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                                        <span style="font-size: var(--text-sm); color: var(--text-secondary);">Ambiente</span>
                                        <span class="badge badge-info">Production</span>
                                    </div>
                                </div>

                                <div style="margin-top: var(--space-4);">
                                    <button class="btn btn-primary w-full" onclick="loadStats()">
                                        <span>üîÑ</span>
                                        <span>Atualizar Estat√≠sticas</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript Core -->
    <script src="/admin/assets/js/admin-core.js"></script>
    
    <!-- JavaScript da P√°gina -->
    <script>
        async function loadStats() {
            try {
                // Carregar estat√≠sticas de usu√°rios
                const usersResponse = await fetch('/api/admin/users?limit=1000', {
                    credentials: 'include'
                });

                if (usersResponse.ok) {
                    const usersData = await usersResponse.json();
                    const users = usersData.users || [];
                    
                    const totalUsers = users.length;
                    const activeUsers = users.filter(u => u.is_active).length;
                    const activeSubscriptions = users.filter(u => u.subscription_valid).length;
                    const expiredSubscriptions = users.filter(u => !u.subscription_valid && u.end_date).length;
                    
                    document.getElementById('totalUsers').textContent = adminCore.formatNumber(totalUsers);
                    document.getElementById('activeUsers').textContent = adminCore.formatNumber(activeUsers);
                    document.getElementById('activeSubscriptions').textContent = adminCore.formatNumber(activeSubscriptions);
                    document.getElementById('expiredSubscriptions').textContent = adminCore.formatNumber(expiredSubscriptions);
                }

                // Carregar estat√≠sticas de conte√∫do
                const contentResponse = await fetch('/api/xxxfollow/stats', {
                    credentials: 'include'
                });

                if (contentResponse.ok) {
                    const stats = await contentResponse.json();
                    document.getElementById('totalModels').textContent = adminCore.formatNumber(stats.totalModels || 0);
                    document.getElementById('totalVideos').textContent = adminCore.formatNumber(stats.totalVideos || 0);
                }

                // Carregar sess√µes ativas
                const sessionsResponse = await fetch('/api/session/active-sessions', {
                    credentials: 'include'
                });

                if (sessionsResponse.ok) {
                    const sessionsData = await sessionsResponse.json();
                    const sessions = sessionsData.sessions || [];
                    const activeSessions = sessions.length;
                    const onlineUsers = sessions.filter(s => s.is_online).length;
                    
                    document.getElementById('activeSessions').textContent = adminCore.formatNumber(activeSessions);
                    document.getElementById('onlineUsers').textContent = adminCore.formatNumber(onlineUsers);
                }

                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('pt-BR');
                adminCore.showNotification('Estat√≠sticas atualizadas com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                adminCore.showNotification('Erro ao carregar estat√≠sticas', 'error');
            }
        }

        // Carregar stats ao iniciar
        window.addEventListener('load', () => {
            loadStats();
        });
    </script>
</body>
</html>
