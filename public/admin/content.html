<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conte√∫do - Admin Panel</title>
    <link rel="stylesheet" href="/admin/styles/admin.css">
    <!-- 
        NOTA: Esta p√°gina usa as tabelas individuais (xxxfollow_models, clubeadulto_videos, etc)
        para permitir edi√ß√£o direta dos dados. As p√°ginas p√∫blicas (all-models.html, model-videos.html)
        usam as VIEWs unificadas (unified_models, unified_videos) para consumo padronizado.
    -->
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>üéØ Admin Panel</h1>
            <p>XXXFollow Scraper</p>
        </div>

        <div class="user-info">
            <div class="user-avatar">üë§</div>
            <div class="user-details">
                <h3 id="username">Admin</h3>
                <p>Administrador</p>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/admin/dashboard.html" class="nav-link">
                    <span>üìä</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/scraper.html" class="nav-link">
                    <span>üé¨</span>
                    <span>XXXFollow Scraper</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/clubeadulto.html" class="nav-link">
                    <span>üîû</span>
                    <span>Clube Adulto & NSFW247</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/content.html" class="nav-link active">
                    <span>üóÇÔ∏è</span>
                    <span>Modelos & V√≠deos (CRUD)</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/todos-videos.html" class="nav-link">
                    <span>üé¨</span>
                    <span>Todos os V√≠deos</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/all-models.html" class="nav-link">
                    <span>üåü</span>
                    <span>Todas as Modelos</span>
                </a>
            </li>
        </ul>

        <button class="logout-btn" onclick="logout()">
            üö™ Sair
        </button>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="page-title">
                <h2>Modelos & V√≠deos (CRUD)</h2>
                <p>Edite e mantenha seus dados com seguran√ßa</p>
            </div>
        </div>

        <div class="content-card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                <h3 class="card-title">üìÅ Fonte de dados</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end;">
                    <button class="btn btn-primary" id="tab-models" onclick="setKind('models')">üë• Modelos</button>
                    <button class="btn" id="tab-videos" onclick="setKind('videos')">üé¨ V√≠deos</button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Fonte</label>
                    <select class="form-select" id="source-select">
                        <option value="xxxfollow">XXXFollow</option>
                        <option value="clubeadulto">Clube Adulto</option>
                        <option value="nsfw247">NSFW247</option>
                    </select>
                </div>
                <div>
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Tabela</label>
                    <select class="form-select" id="table-select"></select>
                </div>
                <div>
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Buscar</label>
                    <input class="form-input" id="search-input" placeholder="Buscar por texto" />
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 5px;">
                <div>
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Filtrar coluna</label>
                    <select class="form-select" id="filter-column-select"></select>
                </div>
                <div>
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Filtrar valor</label>
                    <input class="form-input" id="filter-value-input" placeholder="Valor exato" />
                </div>
                <div id="video-format-filter-container" style="display:none;">
                    <label style="display:block; font-size: 13px; color: #666; margin-bottom: 8px;">Formato do V√≠deo</label>
                    <select class="form-select" id="video-format-select">
                        <option value="">Todos</option>
                        <option value="mp4">MP4</option>
                        <option value="m3u8">M3U8</option>
                    </select>
                </div>
            </div>

            <div style="display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                <button class="btn btn-primary" onclick="reloadRows()">üîÑ Atualizar</button>
                <button class="btn btn-success" onclick="openCreateModal()">‚ûï Criar</button>
            </div>
        </div>

        <div class="content-card">
            <div class="card-header" style="display:flex; justify-content: space-between; align-items: center; gap: 12px;">
                <h3 class="card-title">üßæ Registros</h3>
                <div style="display:flex; gap: 10px; align-items: center;">
                    <button class="btn" id="prev-btn" onclick="changePage(currentPage - 1)">‚Üê</button>
                    <div style="color:#666; font-size: 14px;" id="page-info">-</div>
                    <button class="btn" id="next-btn" onclick="changePage(currentPage + 1)">‚Üí</button>
                </div>
            </div>

            <div id="table-container" class="admin-table-container"></div>
            <div id="empty" style="display:none; color:#666; padding: 10px 2px;">Nenhum registro encontrado.</div>
            <div id="error" style="display:none; color:#ff4b2b; padding: 10px 2px;"></div>
        </div>
    </div>

    <div id="modal" class="admin-modal" style="display:none;">
        <div class="admin-modal-content">
            <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 700; color: #111827;" id="modal-title">Editar</div>
                <button class="btn btn-danger" onclick="closeModal()">‚úï</button>
            </div>

            <div id="modal-form" class="admin-form-grid"></div>

            <div style="display:flex; gap: 10px; justify-content: flex-end; margin-top: 16px; flex-wrap: wrap;">
                <button class="btn" onclick="closeModal()">Cancelar</button>
                <button class="btn btn-danger" id="delete-btn" onclick="deleteRow()">üóëÔ∏è Excluir</button>
                <button class="btn btn-primary" id="save-btn" onclick="saveRow()">üíæ Salvar</button>
            </div>

            <div id="modal-error" style="display:none; color:#ff4b2b; padding-top: 10px;"></div>
        </div>
    </div>

    <div id="video-modal" class="admin-modal" style="display:none;">
        <div class="admin-modal-content" style="max-width: 900px; width: 90%;">
            <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 700; color: #111827;" id="video-modal-title">Testar V√≠deo</div>
                <button class="btn btn-danger" onclick="closeVideoModal()">‚úï</button>
            </div>

            <div id="video-player-container" style="background: #000; border-radius: 8px; overflow: hidden;">
                <video id="video-player" controls style="width: 100%; max-height: 70vh;">
                    <source id="video-source" src="" type="video/mp4">
                    Seu navegador n√£o suporta a tag de v√≠deo.
                </video>
            </div>

            <div id="video-error" style="display:none; color:#ff4b2b; padding-top: 10px; text-align: center;"></div>
        </div>
    </div>

    <script>
        let kind = 'models';
        let source = 'xxxfollow';
        let selectedTable = '';
        let columns = [];

        let currentPage = 1;
        let totalPages = 1;

        let modalMode = 'edit';
        let modalPkColumn = 'id';
        let modalPkValue = null;

        async function checkAuth() {
            try {
                const response = await fetch('/api/admin/verify', { credentials: 'include' });
                if (!response.ok) {
                    window.location.href = '/admin/login.html';
                    return;
                }
                const data = await response.json();
                if (data?.username) {
                    document.getElementById('username').textContent = data.username;
                }
            } catch (error) {
                window.location.href = '/admin/login.html';
            }
        }

        async function logout() {
            try {
                await fetch('/api/admin/logout', { method: 'POST', credentials: 'include' });
                window.location.href = '/admin/login.html';
            } catch (error) {
                window.location.href = '/admin/login.html';
            }
        }

        function setKind(nextKind) {
            kind = nextKind;

            const tabModels = document.getElementById('tab-models');
            const tabVideos = document.getElementById('tab-videos');
            const videoFormatFilter = document.getElementById('video-format-filter-container');

            if (kind === 'models') {
                tabModels.classList.add('btn-primary');
                tabVideos.classList.remove('btn-primary');
                videoFormatFilter.style.display = 'none';
            } else {
                tabVideos.classList.add('btn-primary');
                tabModels.classList.remove('btn-primary');
                videoFormatFilter.style.display = 'block';
            }

            currentPage = 1;
            totalPages = 1;

            updateTableSelect();
        }

        function updateTableSelect() {
            const select = document.getElementById('table-select');
            select.innerHTML = '';

            source = document.getElementById('source-select').value;

            let tableName = '';
            if (source === 'xxxfollow') {
                tableName = kind === 'models' ? 'xxxfollow_models' : 'xxxfollow_videos';
            } else if (source === 'clubeadulto') {
                tableName = kind === 'models' ? 'clubeadulto_models' : 'clubeadulto_videos';
            } else if (source === 'nsfw247') {
                tableName = kind === 'models' ? 'models' : 'videos';
            }

            const opt = document.createElement('option');
            opt.value = tableName;
            opt.textContent = tableName;
            select.appendChild(opt);

            selectedTable = tableName;
            loadColumns();
            loadRows(1);
        }

        function resetFeedback() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('error').textContent = '';
            document.getElementById('empty').style.display = 'none';
        }


        async function loadColumns() {
            resetFeedback();

            const tableSelect = document.getElementById('table-select');
            selectedTable = tableSelect.value;

            const filterColumnSelect = document.getElementById('filter-column-select');
            filterColumnSelect.innerHTML = '';

            try {
                const response = await fetch(`/api/admin/db/columns?table=${encodeURIComponent(selectedTable)}`, { credentials: 'include' });
                const data = await response.json();
                columns = data?.columns || [];

                const emptyOpt = document.createElement('option');
                emptyOpt.value = '';
                emptyOpt.textContent = 'Sem filtro';
                filterColumnSelect.appendChild(emptyOpt);

                columns.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c.column_name;
                    opt.textContent = c.column_name;
                    filterColumnSelect.appendChild(opt);
                });

                modalPkColumn = columns.some(c => c.column_name === 'id') ? 'id' : (columns[0]?.column_name || 'id');
            } catch (error) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Erro ao carregar colunas.';
            }
        }

        async function loadRows(page = 1) {
            resetFeedback();

            const q = document.getElementById('search-input').value || '';
            const filterColumn = document.getElementById('filter-column-select').value;
            const filterValue = document.getElementById('filter-value-input').value;
            const videoFormat = document.getElementById('video-format-select').value;

            const params = new URLSearchParams();
            params.set('table', selectedTable);
            params.set('page', String(page));
            params.set('limit', '50');
            if (q.trim()) params.set('q', q.trim());
            if (filterColumn && filterValue !== '') {
                params.set('filterColumn', filterColumn);
                params.set('filterValue', filterValue);
            }
            if (kind === 'videos' && videoFormat) {
                params.set('videoFormat', videoFormat);
            }

            try {
                const response = await fetch(`/api/admin/db/rows?${params.toString()}`, { credentials: 'include' });
                const data = await response.json();

                if (!response.ok) {
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').textContent = data?.error || 'Erro ao carregar registros.';
                    return;
                }

                const rows = data?.rows || [];
                currentPage = data?.pagination?.page || 1;
                totalPages = data?.pagination?.totalPages || 1;

                renderRows(rows);
                updatePagination(data?.pagination);

                if (rows.length === 0) {
                    document.getElementById('empty').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Erro ao carregar registros.';
            }
        }

        function updatePagination(pagination) {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;

            pageInfo.textContent = `P√°gina ${currentPage} de ${totalPages} (${pagination?.total || 0})`;
        }

        function changePage(page) {
            if (page < 1 || page > totalPages) return;
            loadRows(page);
        }

        function reloadRows() {
            loadRows(1);
        }

        function getVisibleColumns() {
            if (kind === 'models') {
                const essentialCols = ['id', 'name', 'username', 'display_name', 'video_count', 'videos_scraped'];
                return columns.filter(c => essentialCols.includes(c.column_name)).map(c => c.column_name);
            } else {
                const essentialCols = ['id', 'title', 'model_id', 'duration', 'view_count', 'like_count', 'created_at'];
                return columns.filter(c => essentialCols.includes(c.column_name)).map(c => c.column_name);
            }
        }

        function truncateText(text, maxLength = 50) {
            if (!text) return '';
            const str = String(text);
            return str.length > maxLength ? str.substring(0, maxLength) + '...' : str;
        }

        function renderRows(rows) {
            const container = document.getElementById('table-container');
            container.innerHTML = '';

            const table = document.createElement('table');
            table.className = 'admin-table';

            const thead = document.createElement('thead');
            const headRow = document.createElement('tr');

            const visibleColumns = getVisibleColumns();
            visibleColumns.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headRow.appendChild(th);
            });

            const thActions = document.createElement('th');
            thActions.textContent = 'A√ß√µes';
            thActions.style.minWidth = '200px';
            headRow.appendChild(thActions);

            thead.appendChild(headRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            rows.forEach(row => {
                const tr = document.createElement('tr');

                visibleColumns.forEach(col => {
                    const td = document.createElement('td');
                    const v = row[col];
                    if (col === 'title') {
                        td.textContent = truncateText(v, 40);
                        td.title = v;
                    } else {
                        td.textContent = v === null || v === undefined ? '' : String(v);
                    }
                    tr.appendChild(td);
                });

                const tdActions = document.createElement('td');
                tdActions.style.whiteSpace = 'nowrap';
                tdActions.style.display = 'flex';
                tdActions.style.gap = '5px';
                tdActions.style.flexWrap = 'wrap';

                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-sm btn-primary';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.title = 'Editar';
                editBtn.onclick = () => openEditModal(row);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm btn-danger';
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.title = 'Excluir';
                deleteBtn.onclick = () => quickDeleteRow(row);

                const suspendBtn = document.createElement('button');
                suspendBtn.className = 'btn btn-sm';
                suspendBtn.textContent = '‚è∏Ô∏è';
                suspendBtn.title = 'Suspender';
                suspendBtn.onclick = () => suspendRow(row);

                tdActions.appendChild(editBtn);
                tdActions.appendChild(deleteBtn);
                tdActions.appendChild(suspendBtn);

                if (kind === 'videos') {
                    const testBtn = document.createElement('button');
                    testBtn.className = 'btn btn-sm btn-success';
                    testBtn.textContent = '‚ñ∂Ô∏è';
                    testBtn.title = 'Testar V√≠deo';
                    testBtn.onclick = () => testVideo(row);
                    tdActions.appendChild(testBtn);
                }

                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            container.appendChild(table);
        }

        function openCreateModal() {
            modalMode = 'create';
            modalPkValue = null;

            document.getElementById('modal-title').textContent = `Criar em ${selectedTable}`;
            document.getElementById('delete-btn').style.display = 'none';
            document.getElementById('modal-error').style.display = 'none';
            document.getElementById('modal-error').textContent = '';

            renderModalForm({});
            document.getElementById('modal').style.display = 'flex';
        }

        function openEditModal(row) {
            modalMode = 'edit';
            modalPkValue = row[modalPkColumn];

            document.getElementById('modal-title').textContent = `Editar ${selectedTable}`;
            document.getElementById('delete-btn').style.display = 'inline-flex';
            document.getElementById('modal-error').style.display = 'none';
            document.getElementById('modal-error').textContent = '';

            renderModalForm(row);
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function renderModalForm(row) {
            const form = document.getElementById('modal-form');
            form.innerHTML = '';

            columns.forEach(c => {
                const col = c.column_name;

                const field = document.createElement('div');
                field.className = 'admin-form-field';

                const label = document.createElement('label');
                label.textContent = col;

                const input = document.createElement('input');
                input.className = 'form-input';
                input.dataset.column = col;

                const isPk = col === modalPkColumn;
                const isCreate = modalMode === 'create';

                if (!isCreate && isPk) {
                    input.disabled = true;
                }

                const value = row[col];
                input.value = value === null || value === undefined ? '' : String(value);

                field.appendChild(label);
                field.appendChild(input);
                form.appendChild(field);
            });
        }

        function collectFormValues() {
            const inputs = Array.from(document.querySelectorAll('#modal-form input[data-column]'));
            const data = {};

            inputs.forEach(input => {
                const col = input.dataset.column;
                if (!col) return;

                if (modalMode === 'edit' && col === modalPkColumn) {
                    return;
                }

                data[col] = input.value;
            });

            return data;
        }

        async function saveRow() {
            const modalError = document.getElementById('modal-error');
            modalError.style.display = 'none';
            modalError.textContent = '';

            try {
                if (modalMode === 'create') {
                    const payload = { data: collectFormValues() };
                    const response = await fetch(`/api/admin/db/rows?table=${encodeURIComponent(selectedTable)}`, {
                        method: 'POST',
                        credentials: 'include',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        modalError.style.display = 'block';
                        modalError.textContent = data?.error || 'Erro ao criar.';
                        return;
                    }

                    closeModal();
                    loadRows(1);
                    return;
                }

                const updates = collectFormValues();
                const payload = {
                    pkColumn: modalPkColumn,
                    pkValue: modalPkValue,
                    updates
                };

                const response = await fetch(`/api/admin/db/rows?table=${encodeURIComponent(selectedTable)}`, {
                    method: 'PUT',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!response.ok) {
                    modalError.style.display = 'block';
                    modalError.textContent = data?.error || 'Erro ao salvar.';
                    return;
                }

                closeModal();
                loadRows(currentPage);
            } catch (error) {
                modalError.style.display = 'block';
                modalError.textContent = 'Erro ao salvar.';
            }
        }

        async function deleteRow() {
            const modalError = document.getElementById('modal-error');
            modalError.style.display = 'none';
            modalError.textContent = '';

            if (modalMode !== 'edit') return;
            if (!confirm('Tem certeza que deseja excluir este registro?')) return;

            try {
                const params = new URLSearchParams();
                params.set('table', selectedTable);
                params.set('pkColumn', modalPkColumn);
                params.set('pkValue', String(modalPkValue));

                const response = await fetch(`/api/admin/db/rows?${params.toString()}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();
                if (!response.ok) {
                    modalError.style.display = 'block';
                    modalError.textContent = data?.error || 'Erro ao excluir.';
                    return;
                }

                closeModal();
                loadRows(1);
            } catch (error) {
                modalError.style.display = 'block';
                modalError.textContent = 'Erro ao excluir.';
            }
        }

        document.getElementById('source-select').addEventListener('change', () => {
            updateTableSelect();
        });

        document.getElementById('table-select').addEventListener('change', async () => {
            currentPage = 1;
            await loadColumns();
            await loadRows(1);
        });

        document.getElementById('search-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') reloadRows();
        });

        document.getElementById('filter-value-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') reloadRows();
        });

        document.getElementById('video-format-select').addEventListener('change', () => {
            reloadRows();
        });

        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        document.getElementById('video-modal').addEventListener('click', (e) => {
            if (e.target.id === 'video-modal') {
                closeVideoModal();
            }
        });

        async function quickDeleteRow(row) {
            if (!confirm('Tem certeza que deseja excluir este registro?')) return;

            try {
                const pkValue = row[modalPkColumn];
                const params = new URLSearchParams();
                params.set('table', selectedTable);
                params.set('pkColumn', modalPkColumn);
                params.set('pkValue', String(pkValue));

                const response = await fetch(`/api/admin/db/rows?${params.toString()}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();
                if (!response.ok) {
                    alert('Erro ao excluir: ' + (data?.error || 'Erro desconhecido'));
                    return;
                }

                loadRows(currentPage);
            } catch (error) {
                alert('Erro ao excluir registro.');
            }
        }

        async function suspendRow(row) {
            const suspendField = columns.find(c => c.column_name === 'videos_scraped' || c.column_name === 'suspended');
            if (!suspendField) {
                alert('Esta tabela n√£o possui campo de suspens√£o.');
                return;
            }

            const currentValue = row[suspendField.column_name];
            const newValue = !currentValue;

            try {
                const pkValue = row[modalPkColumn];
                const payload = {
                    pkColumn: modalPkColumn,
                    pkValue: pkValue,
                    updates: { [suspendField.column_name]: newValue }
                };

                const response = await fetch(`/api/admin/db/rows?table=${encodeURIComponent(selectedTable)}`, {
                    method: 'PUT',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!response.ok) {
                    alert('Erro ao suspender: ' + (data?.error || 'Erro desconhecido'));
                    return;
                }

                loadRows(currentPage);
            } catch (error) {
                alert('Erro ao suspender registro.');
            }
        }

        function testVideo(row) {
            const videoUrl = row.video_url || row.sd_url;
            const m3u8Url = row.m3u8_url;
            const title = row.title || 'V√≠deo sem t√≠tulo';

            if (!videoUrl && !m3u8Url) {
                alert('Este v√≠deo n√£o possui URL v√°lida.');
                return;
            }

            const videoError = document.getElementById('video-error');
            videoError.style.display = 'none';
            videoError.textContent = '';

            document.getElementById('video-modal-title').textContent = truncateText(title, 60);

            const videoPlayer = document.getElementById('video-player');
            const videoSource = document.getElementById('video-source');

            if (m3u8Url) {
                const proxiedUrl = `/api/proxy/m3u8?url=${encodeURIComponent(m3u8Url)}`;
                if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoSource.src = proxiedUrl;
                    videoSource.type = 'application/vnd.apple.mpegurl';
                } else if (window.Hls && Hls.isSupported()) {
                    if (window.hlsInstance) {
                        window.hlsInstance.destroy();
                    }
                    window.hlsInstance = new Hls();
                    window.hlsInstance.loadSource(proxiedUrl);
                    window.hlsInstance.attachMedia(videoPlayer);
                    window.hlsInstance.on(Hls.Events.ERROR, function (event, data) {
                        if (data.fatal) {
                            videoError.style.display = 'block';
                            videoError.textContent = 'Erro ao carregar v√≠deo M3U8: ' + data.type;
                        }
                    });
                } else {
                    videoError.style.display = 'block';
                    videoError.textContent = 'Seu navegador n√£o suporta HLS. Tente usar Safari ou instale uma extens√£o.';
                }
            } else {
                videoSource.src = videoUrl;
                videoSource.type = 'video/mp4';
            }

            videoPlayer.load();
            document.getElementById('video-modal').style.display = 'flex';
        }

        function closeVideoModal() {
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.pause();
            videoPlayer.currentTime = 0;

            if (window.hlsInstance) {
                window.hlsInstance.destroy();
                window.hlsInstance = null;
            }

            document.getElementById('video-modal').style.display = 'none';
        }

        checkAuth();
        setKind('models');
        updateTableSelect();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
