<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXXFollow - Admin Scraper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }

        .controls {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .controls h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }

        .logs.active {
            display: block;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #00ff00;
            padding-left: 10px;
        }

        .log-entry.error {
            color: #ff4444;
            border-left-color: #ff4444;
        }

        .log-entry.success {
            color: #00ff00;
            border-left-color: #00ff00;
        }

        .log-entry.info {
            color: #4facfe;
            border-left-color: #4facfe;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• XXXFollow Scraper</h1>
            <p>Painel de Administra√ß√£o e Controle de Scraping</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total de Modelos</h3>
                <div class="number" id="stat-models">0</div>
            </div>
            <div class="stat-card">
                <h3>Total de V√≠deos</h3>
                <div class="number" id="stat-videos">0</div>
            </div>
            <div class="stat-card">
                <h3>Modelos Pendentes</h3>
                <div class="number" id="stat-pending">0</div>
            </div>
            <div class="stat-card">
                <h3>V√≠deos Hoje</h3>
                <div class="number" id="stat-today">0</div>
            </div>
        </div>

        <div class="controls">
            <h2>üéÆ Controles de Scraping</h2>
            
            <div style="margin-bottom: 20px;">
                <label for="scrape-page" style="display: block; margin-bottom: 10px; font-weight: bold; color: #667eea;">
                    üìÑ P√°gina de Scraping de Modelos:
                </label>
                <select id="scrape-page" style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 1em; background: white; cursor: pointer;">
                    <option value="most-popular/all">üî• Most Popular (Padr√£o)</option>
                    <option value="contest-winners">üèÜ Contest Winners</option>
                    <option value="newest-creators">‚ú® Newest Creators</option>
                    <option value="tag/teen-18/all">üëß Teen 18+</option>
                    <option value="tag/latina/all">üíÉ Latina</option>
                    <option value="tag/asian/all">üå∏ Asian</option>
                    <option value="tag/ebony/all">üñ§ Ebony</option>
                    <option value="tag/milf/all">üë© MILF</option>
                    <option value="tag/bigass/all">üçë Big Ass</option>
                    <option value="tag/bigboobs/all">üçí Big Boobs</option>
                </select>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="scrapeModels()" id="btn-models">
                    <span>üë•</span>
                    <span>Scrape Modelos</span>
                </button>
                <button class="btn btn-success" onclick="scrapeVideos()" id="btn-videos">
                    <span>üé¨</span>
                    <span>Scrape V√≠deos</span>
                </button>
                <button class="btn btn-success" onclick="scrapeVideoDetails()" id="btn-details">
                    <span>üé•</span>
                    <span>Scrape Detalhes</span>
                </button>
                <button class="btn btn-danger" onclick="stopScraping()" id="btn-stop" style="display:none; background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                    <span>‚õî</span>
                    <span>Parar Scraping</span>
                </button>
                <button class="btn btn-info" onclick="loadStats()">
                    <span>üìä</span>
                    <span>Atualizar Stats</span>
                </button>
                <button class="btn btn-warning" onclick="clearLogs()">
                    <span>üóëÔ∏è</span>
                    <span>Limpar Logs</span>
                </button>
            </div>

            <div class="nav-links">
                <a href="/xxxfollow-models.html" class="nav-link">üìã Ver Modelos</a>
                <a href="/xxxfollow-videos.html" class="nav-link">üé• Ver V√≠deos</a>
                <a href="/admin-scraper.html" class="nav-link">üè† Outros Sites</a>
                <a href="/home.html" class="nav-link">üåê Homepage</a>
            </div>

            <div class="progress-bar" id="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>

            <div class="logs" id="logs"></div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let currentEventSource = null;

        function toggleButtons(running) {
            document.getElementById('btn-models').disabled = running;
            document.getElementById('btn-videos').disabled = running;
            document.getElementById('btn-details').disabled = running;
            document.getElementById('btn-stop').style.display = running ? 'flex' : 'none';
        }

        function stopScraping() {
            if (currentEventSource) {
                currentEventSource.close();
                currentEventSource = null;
            }
            isRunning = false;
            toggleButtons(false);
            addLog('‚õî Scraping interrompido pelo usu√°rio!', 'error');
            updateProgress(0, 'Parado');
        }

        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            logs.classList.add('active');
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('logs').classList.remove('active');
            document.getElementById('progress-bar').classList.remove('active');
        }

        function updateProgress(percent, text) {
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            
            progressBar.classList.add('active');
            progressFill.style.width = percent + '%';
            progressFill.textContent = text || (percent + '%');
        }

        async function loadStats() {
            try {
                addLog('Carregando estat√≠sticas...', 'info');
                
                const response = await fetch('/api/xxxfollow/stats');
                const data = await response.json();
                
                document.getElementById('stat-models').textContent = data.totalModels || 0;
                document.getElementById('stat-videos').textContent = data.totalVideos || 0;
                document.getElementById('stat-pending').textContent = data.pendingModels || 0;
                document.getElementById('stat-today').textContent = data.videosToday || 0;
                
                addLog('Estat√≠sticas atualizadas com sucesso!', 'success');
            } catch (error) {
                addLog('Erro ao carregar estat√≠sticas: ' + error.message, 'error');
            }
        }

        async function scrapeModels() {
            if (isRunning) {
                addLog('J√° existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            
            const scrapePage = document.getElementById('scrape-page').value;
            const pageLabel = document.getElementById('scrape-page').selectedOptions[0].text;
            
            addLog(`üöÄ Iniciando scraping de modelos: ${pageLabel}`, 'info');
            addLog(`üìÑ URL: https://www.xxxfollow.com/${scrapePage}`, 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource(`/api/xxxfollow/scrape-models-stream?page=${encodeURIComponent(scrapePage)}`);
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        // Detectar tipo de log e adicionar com cor apropriada
                        if (message.includes('‚úì') || message.includes('‚úÖ')) {
                            addLog(message, 'success');
                        } else if (message.includes('‚ùå') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        // Atualizar progresso baseado em palavras-chave
                        if (message.includes('Acessando')) {
                            progress = Math.min(progress + 10, 50);
                            updateProgress(progress, 'Coletando dados...');
                        } else if (message.includes('salva')) {
                            progress = Math.min(progress + 5, 90);
                            updateProgress(progress, 'Salvando modelos...');
                        }
                    } else if (data.type === 'error') {
                        addLog('‚ùå ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'Conclu√≠do!');
                        addLog('‚úÖ Scraping de modelos conclu√≠do!', 'success');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                currentEventSource.onerror = (error) => {
                    addLog('‚ùå Erro na conex√£o: ' + error, 'error');
                    currentEventSource.close();
                    currentEventSource = null;
                    isRunning = false;
                    toggleButtons(false);
                };
                
            } catch (error) {
                addLog('‚ùå Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        async function scrapeVideos() {
            if (isRunning) {
                addLog('J√° existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            addLog('üöÄ Iniciando scraping de v√≠deos do XXXFollow...', 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource('/api/xxxfollow/scrape-videos-stream');
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        // Detectar tipo de log e adicionar com cor apropriada
                        if (message.includes('‚úì') || message.includes('‚úÖ')) {
                            addLog(message, 'success');
                        } else if (message.includes('‚ùå') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        // Atualizar progresso baseado em palavras-chave
                        if (message.includes('Scraping v√≠deos')) {
                            progress = Math.min(progress + 10, 50);
                            updateProgress(progress, 'Processando modelo...');
                        } else if (message.includes('V√≠deo salvo')) {
                            progress = Math.min(progress + 2, 90);
                            updateProgress(progress, 'Salvando v√≠deos...');
                        } else if (message.includes('conclu√≠do')) {
                            progress = Math.min(progress + 5, 95);
                        }
                    } else if (data.type === 'error') {
                        addLog('‚ùå ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'Conclu√≠do!');
                        addLog('‚úÖ Scraping de v√≠deos conclu√≠do!', 'success');
                        eventSource.close();
                        isRunning = false;
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                eventSource.onerror = (error) => {
                    addLog('‚ùå Erro na conex√£o: ' + error, 'error');
                    eventSource.close();
                    isRunning = false;
                };
                
            } catch (error) {
                addLog('‚ùå Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        async function scrapeVideoDetails() {
            if (isRunning) {
                addLog('J√° existe um scraping em andamento!', 'error');
                return;
            }

            isRunning = true;
            toggleButtons(true);
            clearLogs();
            addLog('üöÄ Iniciando scraping de detalhes dos v√≠deos...', 'info');
            updateProgress(10, 'Conectando...');

            try {
                currentEventSource = new EventSource('/api/xxxfollow/scrape-video-details-stream');
                let progress = 10;
                
                currentEventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'log') {
                        const message = data.message;
                        
                        if (message.includes('‚úì') || message.includes('‚úÖ')) {
                            addLog(message, 'success');
                        } else if (message.includes('‚ùå') || message.includes('Erro')) {
                            addLog(message, 'error');
                        } else {
                            addLog(message, 'info');
                        }
                        
                        if (message.includes('Source atualizado')) {
                            progress = Math.min(progress + 2, 90);
                            updateProgress(progress, 'Extraindo sources...');
                        }
                    } else if (data.type === 'error') {
                        addLog('‚ùå ' + data.message, 'error');
                    } else if (data.type === 'done') {
                        updateProgress(100, 'Conclu√≠do!');
                        addLog('‚úÖ Scraping de detalhes conclu√≠do!', 'success');
                        currentEventSource.close();
                        currentEventSource = null;
                        isRunning = false;
                        toggleButtons(false);
                        setTimeout(() => loadStats(), 1000);
                    }
                };
                
                currentEventSource.onerror = (error) => {
                    addLog('‚ùå Erro na conex√£o: ' + error, 'error');
                    currentEventSource.close();
                    currentEventSource = null;
                    isRunning = false;
                    toggleButtons(false);
                };
                
            } catch (error) {
                addLog('‚ùå Erro: ' + error.message, 'error');
                isRunning = false;
            }
        }

        // Carregar estat√≠sticas ao abrir a p√°gina
        window.addEventListener('load', () => {
            loadStats();
        });
    </script>
</body>
</html>
